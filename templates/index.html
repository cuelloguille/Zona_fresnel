<!DOCTYPE html> <!-- Declara el tipo de documento HTML5 -->
<html lang="es"> <!-- Indica que el contenido est치 en espa침ol -->
<head>
    <meta charset="UTF-8"> <!-- Codificaci칩n de caracteres en UTF-8 -->
    <title>Calculadora Zona de Fresnel</title> <!-- T칤tulo de la pesta침a del navegador -->
    
    <!-- Enlace al archivo de estilos CSS que est치 en la carpeta 'static' -->
    <link rel="stylesheet" href="{{ url_for('static', filename='estilo.css') }}">
    
    <!-- Importa la librer칤a Chart.js desde CDN para dibujar gr치ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>游니 Calculadora Zona de Fresnel</h1> <!-- T칤tulo principal de la p치gina -->

    <!-- Formulario que se env칤a mediante POST al backend Flask -->
    <form method="POST">
        <label>Distancia entre antenas (en <strong>km</strong>):</label>
        <input type="text" name="distancia" placeholder="Ej: 1.2" required value="{{ distancia }}">

        <label>Frecuencia de la se침al (en <strong>GHz</strong>):</label>
        <input type="text" name="frecuencia" placeholder="Ej: 2.4" required value="{{ frecuencia }}">

        <hr>
        <h3>游댢 Opcional: Alturas de las antenas</h3>
        <hr>

        <!-- Campos opcionales para alturas -->
        <label>Altura de la antena 1 (en <strong>m</strong>):</label>
        <input type="text" name="altura1" placeholder="Ej: 30" value="{{ altura1 }}">

        <label>Altura de la antena 2 (en <strong>m</strong>):</label>
        <input type="text" name="altura2" placeholder="Ej: 45" value="{{ altura2 }}">

        <hr>
        <button type="submit">Calcular</button> <!-- Bot칩n para enviar el formulario -->
    </form>

    <!-- Secci칩n que aparece solo si hay resultado (HTML condicional de Jinja2) -->
    {% if resultado %}
    <div class="resultado">
        <!-- Muestra el resultado con formato HTML seguro -->
        <p style="font-weight: bold;">{{ resultado|safe }}</p>
    </div>

    <div class="grafico">
        <h2>游늵 Representaci칩n de la Zona de Fresnel</h2>
        <canvas id="fresnelChart" width="600" height="300"></canvas> <!-- 츼rea para el gr치fico -->

        <script>
            // Variables recibidas del backend
            const distancia = {{ distancia | default(0) }};
            const fresnel = {{ fresnel | default(0) }};
            const altura1 = {{ altura1 if altura1 is not none else 'null' }};
            const altura2 = {{ altura2 if altura2 is not none else 'null' }};

            // Inicializa arrays para puntos del gr치fico
            const numPuntos = 100;
            const puntosX = [];
            const puntosY_superior = [];
            const puntosY_inferior = [];
            const lineaVisual = [];

            // Calcula puntos a lo largo de la distancia entre antenas
            for (let i = 0; i <= numPuntos; i++) {
                const x = (i / numPuntos) * distancia;
                const factor = Math.sqrt(1 - Math.pow((2 * x / distancia - 1), 2)); // Factor el칤ptico
                const yFresnel = fresnel * factor;

                // Base: l칤nea visual entre antenas o 40% del Fresnel si no hay alturas
                let base;
                if (altura1 !== null && altura2 !== null) {
                    base = altura1 + ((altura2 - altura1) * (x / distancia));
                } else {
                    base = fresnel * 0.4;
                }

                // Agrega los puntos al gr치fico
                puntosX.push(x.toFixed(2));
                puntosY_superior.push((base + yFresnel).toFixed(2));
                puntosY_inferior.push((base - yFresnel).toFixed(2));
                lineaVisual.push(base.toFixed(2));
            }

            // Configura y renderiza el gr치fico con Chart.js
            const ctx = document.getElementById('fresnelChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: puntosX,
                    datasets: [
                        {
                            label: 'Zona de Fresnel (superior)',
                            data: puntosY_superior,
                            borderColor: 'blue',
                            backgroundColor: 'rgba(0, 0, 255, 0.1)',
                            fill: '-1',  // Rellena hasta el dataset anterior
                            pointRadius: 0
                        },
                        {
                            label: 'Zona de Fresnel (inferior)',
                            data: puntosY_inferior,
                            borderColor: 'blue',
                            backgroundColor: 'rgba(0, 0, 255, 0.1)',
                            fill: false,
                            pointRadius: 0
                        },
                        {
                            label: 'L칤nea visual entre antenas',
                            data: lineaVisual,
                            borderColor: 'red',
                            borderDash: [5, 5], // L칤nea punteada
                            fill: false,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Distancia (km)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Altura (m)'
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
        </script>
    </div>
    {% endif %} <!-- Fin de la condici칩n de resultado -->

    <!-- Imagen con la f칩rmula matem치tica de Fresnel -->
    <div class="formula">
        <h2>游늻 F칩rmula utilizada</h2>
        <img src="{{ url_for('static', filename='formula.png') }}" alt="Zona de Fresnel" width="400">
    </div>

    <!-- Pie de p치gina con autor -->
    <footer>
        Creado por: <strong>Guillermo Cuello</strong>
    </footer>
</body>
</html>
